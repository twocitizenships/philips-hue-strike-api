{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.schedulesApi = void 0;\n\nconst hue_bridge_model_1 = require(\"@peter-murray/hue-bridge-model\");\n\nconst util_1 = require(\"../../../util\");\n\nconst ApiEndpoint_1 = require(\"./ApiEndpoint\");\n\nconst ScheduleIdPlaceholder_1 = require(\"../../placeholders/ScheduleIdPlaceholder\");\n\nconst ApiError_1 = require(\"../../../ApiError\");\n\nconst SCHEDULE_ID_PLACEHOLDER = new ScheduleIdPlaceholder_1.ScheduleIdPlaceholder();\nconst instanceChecks = hue_bridge_model_1.model.instanceChecks;\nconst schedulesApi = {\n  getAll: new ApiEndpoint_1.ApiEndpoint().get().acceptJson().uri('/<username>/schedules').pureJson().postProcess(buildSchedulesResult),\n  createSchedule: new ApiEndpoint_1.ApiEndpoint().post().acceptJson().uri('/<username>/schedules').pureJson().payload(buildSchedulePayload).postProcess(buildCreateScheduleResult),\n  getScheduleAttributes: new ApiEndpoint_1.ApiEndpoint().get().uri('/<username>/schedules/<id>').placeholder(SCHEDULE_ID_PLACEHOLDER).acceptJson().pureJson().postProcess(buildSchedule),\n  setScheduleAttributes: new ApiEndpoint_1.ApiEndpoint().put().uri('/<username>/schedules/<id>').placeholder(SCHEDULE_ID_PLACEHOLDER).acceptJson().payload(buildUpdateSchedulePayload).pureJson().postProcess(util_1.extractUpdatedAttributes),\n  deleteSchedule: new ApiEndpoint_1.ApiEndpoint().delete().acceptJson().uri('/<username>/schedules/<id>').placeholder(SCHEDULE_ID_PLACEHOLDER).pureJson().postProcess(util_1.wasSuccessful)\n};\nexports.schedulesApi = schedulesApi;\n\nfunction buildSchedulesResult(result) {\n  let schedules = [];\n  Object.keys(result).forEach(function (id) {\n    schedules.push(hue_bridge_model_1.model.createFromBridge('schedule', id, result[id]));\n  });\n  return schedules;\n}\n\nfunction buildSchedule(data, requestParameters) {\n  const id = SCHEDULE_ID_PLACEHOLDER.getValue(requestParameters);\n  return hue_bridge_model_1.model.createFromBridge('schedule', id, data);\n}\n\nfunction buildSchedulePayload(parameters) {\n  const schedule = parameters.schedule;\n\n  if (!schedule) {\n    throw new ApiError_1.ApiError('Schedule to create must be provided');\n  } else if (!instanceChecks.isScheduleInstance(schedule)) {\n    throw new ApiError_1.ApiError('You must provide a valid instance of a Schedule to be created');\n  }\n\n  const payload = getSchedulePayload(parameters.username, schedule);\n  return {\n    type: 'application/json',\n    body: payload\n  };\n}\n\nfunction buildUpdateSchedulePayload(parameters) {\n  const schedule = parameters.schedule;\n\n  if (!schedule) {\n    throw new ApiError_1.ApiError('Schedule to update must be provided');\n  } else if (!instanceChecks.isScheduleInstance(schedule)) {\n    throw new ApiError_1.ApiError('You must provide a valid instance of a Schedule when updating');\n  }\n\n  const payload = getSchedulePayload(parameters.username, schedule); // Extract only the values we can update on a schedule\n\n  const body = {};\n  ['name', 'description', 'command', 'localtime', 'status', 'autodelete'].forEach(key => {\n    if (payload[key] !== null) {\n      body[key] = payload[key];\n    }\n  });\n  return {\n    type: 'application/json',\n    body: body\n  };\n}\n\nfunction buildCreateScheduleResult(result) {\n  const hueErrors = (0, util_1.parseErrors)(result); //TODO not sure if this still gets called as the request handles some of this\n\n  if (hueErrors) {\n    throw new ApiError_1.ApiError(`Error creating group: ${hueErrors[0].description}`, hueErrors[0]);\n  }\n\n  const id = result[0].success.id;\n  return {\n    id: SCHEDULE_ID_PLACEHOLDER.getValue({\n      id: id\n    })\n  };\n}\n\nfunction getSchedulePayload(username, schedule) {\n  const payload = schedule.getHuePayload();\n\n  if (hue_bridge_model_1.time.isRecurring(payload.localtime)) {\n    // autodelete does not apply to recurring schedules (as specified in the localtime)\n    delete payload.autodelete;\n  } // Fix the address from the action to start with \"/api/{username}\"\n\n\n  const address = payload.command.address;\n\n  if (!/^\\/api\\//.test(address)) {\n    payload.command.address = `/api/${username}${address}`;\n  }\n\n  return payload;\n}","map":{"version":3,"sources":["/Users/clusk/Documents/OtherRepositories/StrikeElectric/node_modules/node-hue-api/dist/cjs/api/http/endpoints/schedules.js"],"names":["Object","defineProperty","exports","value","schedulesApi","hue_bridge_model_1","require","util_1","ApiEndpoint_1","ScheduleIdPlaceholder_1","ApiError_1","SCHEDULE_ID_PLACEHOLDER","ScheduleIdPlaceholder","instanceChecks","model","getAll","ApiEndpoint","get","acceptJson","uri","pureJson","postProcess","buildSchedulesResult","createSchedule","post","payload","buildSchedulePayload","buildCreateScheduleResult","getScheduleAttributes","placeholder","buildSchedule","setScheduleAttributes","put","buildUpdateSchedulePayload","extractUpdatedAttributes","deleteSchedule","delete","wasSuccessful","result","schedules","keys","forEach","id","push","createFromBridge","data","requestParameters","getValue","parameters","schedule","ApiError","isScheduleInstance","getSchedulePayload","username","type","body","key","hueErrors","parseErrors","description","success","getHuePayload","time","isRecurring","localtime","autodelete","address","command","test"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.schedulesApi = void 0;\nconst hue_bridge_model_1 = require(\"@peter-murray/hue-bridge-model\");\nconst util_1 = require(\"../../../util\");\nconst ApiEndpoint_1 = require(\"./ApiEndpoint\");\nconst ScheduleIdPlaceholder_1 = require(\"../../placeholders/ScheduleIdPlaceholder\");\nconst ApiError_1 = require(\"../../../ApiError\");\nconst SCHEDULE_ID_PLACEHOLDER = new ScheduleIdPlaceholder_1.ScheduleIdPlaceholder();\nconst instanceChecks = hue_bridge_model_1.model.instanceChecks;\nconst schedulesApi = {\n    getAll: new ApiEndpoint_1.ApiEndpoint()\n        .get()\n        .acceptJson()\n        .uri('/<username>/schedules')\n        .pureJson()\n        .postProcess(buildSchedulesResult),\n    createSchedule: new ApiEndpoint_1.ApiEndpoint()\n        .post()\n        .acceptJson()\n        .uri('/<username>/schedules')\n        .pureJson()\n        .payload(buildSchedulePayload)\n        .postProcess(buildCreateScheduleResult),\n    getScheduleAttributes: new ApiEndpoint_1.ApiEndpoint()\n        .get()\n        .uri('/<username>/schedules/<id>')\n        .placeholder(SCHEDULE_ID_PLACEHOLDER)\n        .acceptJson()\n        .pureJson()\n        .postProcess(buildSchedule),\n    setScheduleAttributes: new ApiEndpoint_1.ApiEndpoint()\n        .put()\n        .uri('/<username>/schedules/<id>')\n        .placeholder(SCHEDULE_ID_PLACEHOLDER)\n        .acceptJson()\n        .payload(buildUpdateSchedulePayload)\n        .pureJson()\n        .postProcess(util_1.extractUpdatedAttributes),\n    deleteSchedule: new ApiEndpoint_1.ApiEndpoint()\n        .delete()\n        .acceptJson()\n        .uri('/<username>/schedules/<id>')\n        .placeholder(SCHEDULE_ID_PLACEHOLDER)\n        .pureJson()\n        .postProcess(util_1.wasSuccessful),\n};\nexports.schedulesApi = schedulesApi;\nfunction buildSchedulesResult(result) {\n    let schedules = [];\n    Object.keys(result).forEach(function (id) {\n        schedules.push(hue_bridge_model_1.model.createFromBridge('schedule', id, result[id]));\n    });\n    return schedules;\n}\nfunction buildSchedule(data, requestParameters) {\n    const id = SCHEDULE_ID_PLACEHOLDER.getValue(requestParameters);\n    return hue_bridge_model_1.model.createFromBridge('schedule', id, data);\n}\nfunction buildSchedulePayload(parameters) {\n    const schedule = parameters.schedule;\n    if (!schedule) {\n        throw new ApiError_1.ApiError('Schedule to create must be provided');\n    }\n    else if (!instanceChecks.isScheduleInstance(schedule)) {\n        throw new ApiError_1.ApiError('You must provide a valid instance of a Schedule to be created');\n    }\n    const payload = getSchedulePayload(parameters.username, schedule);\n    return {\n        type: 'application/json',\n        body: payload\n    };\n}\nfunction buildUpdateSchedulePayload(parameters) {\n    const schedule = parameters.schedule;\n    if (!schedule) {\n        throw new ApiError_1.ApiError('Schedule to update must be provided');\n    }\n    else if (!instanceChecks.isScheduleInstance(schedule)) {\n        throw new ApiError_1.ApiError('You must provide a valid instance of a Schedule when updating');\n    }\n    const payload = getSchedulePayload(parameters.username, schedule);\n    // Extract only the values we can update on a schedule\n    const body = {};\n    ['name', 'description', 'command', 'localtime', 'status', 'autodelete'].forEach(key => {\n        if (payload[key] !== null) {\n            body[key] = payload[key];\n        }\n    });\n    return {\n        type: 'application/json',\n        body: body\n    };\n}\nfunction buildCreateScheduleResult(result) {\n    const hueErrors = (0, util_1.parseErrors)(result); //TODO not sure if this still gets called as the request handles some of this\n    if (hueErrors) {\n        throw new ApiError_1.ApiError(`Error creating group: ${hueErrors[0].description}`, hueErrors[0]);\n    }\n    const id = result[0].success.id;\n    return {\n        id: SCHEDULE_ID_PLACEHOLDER.getValue({ id: id })\n    };\n}\nfunction getSchedulePayload(username, schedule) {\n    const payload = schedule.getHuePayload();\n    if (hue_bridge_model_1.time.isRecurring(payload.localtime)) {\n        // autodelete does not apply to recurring schedules (as specified in the localtime)\n        delete payload.autodelete;\n    }\n    // Fix the address from the action to start with \"/api/{username}\"\n    const address = payload.command.address;\n    if (!/^\\/api\\//.test(address)) {\n        payload.command.address = `/api/${username}${address}`;\n    }\n    return payload;\n}\n"]},"metadata":{},"sourceType":"script"}