{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{Button,CircularProgress,Popover}from'@mui/material';import{Invoice}from'./components';import{discoverAndCreateUser}from'./connectToBridge';import{api,INVOICE_STATE_UNPAID,INVOICE_STATE_PAID}from'./lib/api.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const PARTNER_API_URL=\"https://api.next.strike.me/v1/\";const THEME_DEFAULT='default';const THEME_NONE='none';const getDefaultCurrency=profile=>{return profile.currencies.find(c=>c.isDefaultCurrency).currency;};const createInvoice=async(handle,amount,currency)=>{return await api.createInvoice(handle,amount,currency);};const createQuote=async invoiceId=>{return await api.createQuote(invoiceId);};const getInvoice=async invoiceId=>{return await api.getInvoice(invoiceId);};// Initialize the app\nexport default function App(_ref){let{apikey,handle,amount=1,theme=THEME_DEFAULT}=_ref;api.init(PARTNER_API_URL,apikey);const[profile,setProfile]=useState(null);const[invoice,setInvoice]=useState(null);const[quote,setQuote]=useState(null);const[isFetchingInvoice,setIsFetchingInvoice]=useState(false);const[anchorEl,setAnchorEl]=React.useState(null);const handleClose=()=>{setQuote(null);setAnchorEl(null);};//\n// Button click handler\n//\nconst handleButtonClick=async(event,amount)=>{setAnchorEl(event.currentTarget);setIsFetchingInvoice(true);var updatedInvoice=invoice;if(!updatedInvoice){updatedInvoice=await createInvoice(handle,amount,profile.currencies.find(c=>c.isDefaultCurrency).currency);setInvoice(updatedInvoice);}const updatedQuote=await createQuote(updatedInvoice.invoiceId);setQuote(updatedQuote);setIsFetchingInvoice(false);};//\n// Widget Initialiation\n//\nuseEffect(async()=>{var profile=await api.getProfile(handle);setProfile(profile);},[]);//\n// Invoice interactions.\n//\nuseEffect(()=>{if(quote===null){return;}var successTimeoutId;const refreshTimerId=setTimeout(async()=>{const updatedInvoice=await getInvoice(invoice.invoiceId);setInvoice(updatedInvoice);if(updatedInvoice.state!==INVOICE_STATE_UNPAID){setQuote(null);successTimeoutId=setTimeout(()=>{setInvoice(null);},3000);}if(new Date(quote.expiration)<new Date()){setQuote(null);}},1000);return()=>{clearTimeout(refreshTimerId);clearTimeout(successTimeoutId);};},[invoice,quote]);const isUnpaid=(invoice===null||invoice===void 0?void 0:invoice.state)===INVOICE_STATE_UNPAID&&quote!==null;const isPaid=(invoice===null||invoice===void 0?void 0:invoice.state)===INVOICE_STATE_PAID;if(!profile){return null;};// Initialize Philips Hue Bridge connection\ndiscoverAndCreateUser();// \nreturn/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Button,{variant:\"contained\",onClick:e=>handleButtonClick(e,amount),fullWidth:true,children:[isFetchingInvoice&&/*#__PURE__*/_jsx(CircularProgress,{size:24}),isPaid?\"Thank You!\":`Tip ${handle} ${amount} ${getDefaultCurrency(profile)}`]}),/*#__PURE__*/_jsx(Popover,{open:isUnpaid,anchorEl:anchorEl,onClose:handleClose,anchorOrigin:{vertical:'bottom',horizontal:'center'},transformOrigin:{vertical:'top',horizontal:'center'},children:isUnpaid&&/*#__PURE__*/_jsx(Invoice,{quote:quote,size:250,m:2})})]});}","map":{"version":3,"sources":["/Users/clusk/Documents/OtherRepositories/StrikeElectric/src/App.js"],"names":["React","useState","useEffect","Button","CircularProgress","Popover","Invoice","discoverAndCreateUser","api","INVOICE_STATE_UNPAID","INVOICE_STATE_PAID","PARTNER_API_URL","THEME_DEFAULT","THEME_NONE","getDefaultCurrency","profile","currencies","find","c","isDefaultCurrency","currency","createInvoice","handle","amount","createQuote","invoiceId","getInvoice","App","apikey","theme","init","setProfile","invoice","setInvoice","quote","setQuote","isFetchingInvoice","setIsFetchingInvoice","anchorEl","setAnchorEl","handleClose","handleButtonClick","event","currentTarget","updatedInvoice","updatedQuote","getProfile","successTimeoutId","refreshTimerId","setTimeout","state","Date","expiration","clearTimeout","isUnpaid","isPaid","e","vertical","horizontal"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Button, CircularProgress, Popover } from '@mui/material';\nimport { Invoice } from './components'\nimport { discoverAndCreateUser } from './connectToBridge'\nimport { api, INVOICE_STATE_UNPAID, INVOICE_STATE_PAID } from './lib/api.js'\n\nconst PARTNER_API_URL = \"https://api.next.strike.me/v1/\";\nconst THEME_DEFAULT = 'default';\nconst THEME_NONE = 'none';\n\nconst getDefaultCurrency = profile => {\n  return profile.currencies.find(c => c.isDefaultCurrency).currency;\n}\n\nconst createInvoice = async (handle, amount, currency) => {\n  return await api.createInvoice(handle, amount, currency);\n};\n\nconst createQuote = async invoiceId => {\n  return await api.createQuote(invoiceId);\n};\n\nconst getInvoice = async invoiceId => {\n  return await api.getInvoice(invoiceId);\n};\n\n// Initialize the app\nexport default function App({ apikey, handle, amount = 1, theme = THEME_DEFAULT }) {\n  api.init(PARTNER_API_URL, apikey);\n\n  const [profile, setProfile] = useState(null);\n  const [invoice, setInvoice] = useState(null);\n  const [quote, setQuote] = useState(null);\n  const [isFetchingInvoice, setIsFetchingInvoice] = useState(false);\n\n  const [anchorEl, setAnchorEl] = React.useState(null);\n\n  const handleClose = () => {\n    setQuote(null);\n    setAnchorEl(null);\n  };\n\n  //\n  // Button click handler\n  //\n  const handleButtonClick = async (event, amount) => {\n    setAnchorEl(event.currentTarget);\n    setIsFetchingInvoice(true);\n\n    var updatedInvoice = invoice;\n    if (!updatedInvoice) {\n      updatedInvoice = await createInvoice(handle, amount, profile.currencies.find(c => c.isDefaultCurrency).currency);\n      setInvoice(updatedInvoice);\n    }\n\n    const updatedQuote = await createQuote(updatedInvoice.invoiceId);\n    setQuote(updatedQuote)\n\n    setIsFetchingInvoice(false);\n  };\n\n  //\n  // Widget Initialiation\n  //\n  useEffect(async () => {\n    var profile = await api.getProfile(handle)\n    setProfile(profile);\n  }, []);\n\n\n  //\n  // Invoice interactions.\n  //\n  useEffect(() => {\n    if (quote === null) {\n      return;\n    }\n\n    var successTimeoutId;\n    const refreshTimerId = setTimeout(async () => {\n      const updatedInvoice = await getInvoice(invoice.invoiceId);\n      setInvoice(updatedInvoice);\n\n      if (updatedInvoice.state !== INVOICE_STATE_UNPAID) {\n        setQuote(null);\n        successTimeoutId = setTimeout(() => { setInvoice(null); }, 3000);\n      }\n\n      if (new Date(quote.expiration) < new Date()) {\n        setQuote(null);\n      }\n    }, 1000);\n\n    return () => {\n      clearTimeout(refreshTimerId);\n      clearTimeout(successTimeoutId);\n    }\n  }, [invoice, quote]);\n\n  const isUnpaid = invoice?.state === INVOICE_STATE_UNPAID && quote !== null;\n  const isPaid = invoice?.state === INVOICE_STATE_PAID;\n\n  if (!profile) {\n    return null\n  };\n\n  // Initialize Philips Hue Bridge connection\n  discoverAndCreateUser()\n  // \n\n  return (\n    <div>\n      <Button variant=\"contained\" onClick={e => handleButtonClick(e, amount)} fullWidth>\n        {isFetchingInvoice && <CircularProgress size={24} />}\n        {isPaid ? \"Thank You!\" : `Tip ${handle} ${amount} ${getDefaultCurrency(profile)}`}\n      </Button>\n\n      <Popover\n        open={isUnpaid}\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n        transformOrigin={{ vertical: 'top', horizontal: 'center' }}>\n          {isUnpaid && <Invoice quote={quote} size={250} m={2} />}\n      </Popover>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}