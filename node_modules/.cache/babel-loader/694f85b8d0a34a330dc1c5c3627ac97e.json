{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.rulesApi = void 0;\n\nconst hue_bridge_model_1 = require(\"@peter-murray/hue-bridge-model\");\n\nconst RuleIdPlaceholder_1 = require(\"../../placeholders/RuleIdPlaceholder\");\n\nconst ApiEndpoint_1 = require(\"./ApiEndpoint\");\n\nconst util_1 = require(\"../../../util\");\n\nconst ApiError_1 = require(\"../../../ApiError\");\n\nconst instanceChecks = hue_bridge_model_1.model.instanceChecks;\nconst RULE_ID_PLACEHOLDER = new RuleIdPlaceholder_1.RuleIdPlaceholder();\nconst rulesApi = {\n  getAll: new ApiEndpoint_1.ApiEndpoint().get().acceptJson().uri('/<username>/rules').pureJson().postProcess(createAllRulesResult),\n  getRule: new ApiEndpoint_1.ApiEndpoint().get().acceptJson().uri('<username>/rules/<id>').placeholder(RULE_ID_PLACEHOLDER).pureJson().postProcess(createGetRuleResult),\n  createRule: new ApiEndpoint_1.ApiEndpoint().post().acceptJson().uri('/<username>/rules').pureJson().payload(createRulePayload).postProcess(getCreateRuleResult),\n  updateRule: new ApiEndpoint_1.ApiEndpoint().put().acceptJson().uri('/<username>/rules/<id>').placeholder(RULE_ID_PLACEHOLDER).pureJson().payload(createRuleUpdatePayload).postProcess(util_1.extractUpdatedAttributes),\n  deleteRule: new ApiEndpoint_1.ApiEndpoint().delete().acceptJson().uri('/<username>/rules/<id>').placeholder(RULE_ID_PLACEHOLDER).pureJson().postProcess(validateRuleDeletion)\n};\nexports.rulesApi = rulesApi;\n\nfunction createAllRulesResult(result) {\n  let rules = [];\n  Object.keys(result).forEach(function (id) {\n    const rule = hue_bridge_model_1.model.createFromBridge('rule', id, result[id]);\n    rules.push(rule);\n  });\n  return rules;\n}\n\nfunction createGetRuleResult(data, requestParameters) {\n  const id = RULE_ID_PLACEHOLDER.getValue(requestParameters);\n  return hue_bridge_model_1.model.createFromBridge('rule', id, data);\n}\n\nfunction validateRuleDeletion(result) {\n  if (!(0, util_1.wasSuccessful)(result)) {\n    const parsed = (0, util_1.parseErrors)(result);\n    throw new ApiError_1.ApiError(parsed ? parsed.join(', ') : `Unexpected result: ${JSON.stringify(result)}`);\n  }\n\n  return true;\n}\n\nfunction createRulePayload(parameters) {\n  const rule = parameters.rule;\n\n  if (!rule) {\n    throw new ApiError_1.ApiError('No rule provided');\n  } else if (!instanceChecks.isRuleInstance(rule)) {\n    throw new ApiError_1.ApiError('Must provide a valid Rule object');\n  }\n\n  const body = rule.getHuePayload();\n  validateRulePayloadForBridge(body);\n  return {\n    type: 'application/json',\n    body: body\n  };\n}\n\nfunction createRuleUpdatePayload(parameters) {\n  const rule = parameters.rule;\n\n  if (!rule) {\n    throw new ApiError_1.ApiError('No rule provided');\n  } else if (!instanceChecks.isRuleInstance(rule)) {\n    throw new ApiError_1.ApiError('Must provide a valid Rule object');\n  }\n\n  const hueRule = rule.getHuePayload(),\n        body = {\n    name: hueRule.name,\n    conditions: hueRule.conditions,\n    actions: hueRule.actions\n  };\n  validateRulePayloadForBridge(body);\n  return {\n    type: 'application/json',\n    body: body\n  };\n}\n\nfunction getCreateRuleResult(result) {\n  const hueErrors = (0, util_1.parseErrors)(result); //TODO not sure if this still gets called as the request handles some of this\n\n  if (hueErrors) {\n    throw new ApiError_1.ApiError(`Error creating rule: ${hueErrors[0].description}`, hueErrors[0]);\n  }\n\n  return {\n    id: result[0].success.id\n  };\n}\n\nfunction validateRulePayloadForBridge(rule) {\n  if (!rule.name) {\n    throw new ApiError_1.ApiError('A name must be provided for the Rule');\n  }\n\n  if (!rule.conditions || rule.conditions.length < 1) {\n    throw new ApiError_1.ApiError('A Rule must have at least one condition');\n  }\n\n  if (!rule.actions || rule.actions.length < 1) {\n    throw new ApiError_1.ApiError('A Rule must have at least one action');\n  }\n}","map":{"version":3,"sources":["/Users/clusk/Documents/OtherRepositories/StrikeElectric/node_modules/node-hue-api/dist/cjs/api/http/endpoints/rules.js"],"names":["Object","defineProperty","exports","value","rulesApi","hue_bridge_model_1","require","RuleIdPlaceholder_1","ApiEndpoint_1","util_1","ApiError_1","instanceChecks","model","RULE_ID_PLACEHOLDER","RuleIdPlaceholder","getAll","ApiEndpoint","get","acceptJson","uri","pureJson","postProcess","createAllRulesResult","getRule","placeholder","createGetRuleResult","createRule","post","payload","createRulePayload","getCreateRuleResult","updateRule","put","createRuleUpdatePayload","extractUpdatedAttributes","deleteRule","delete","validateRuleDeletion","result","rules","keys","forEach","id","rule","createFromBridge","push","data","requestParameters","getValue","wasSuccessful","parsed","parseErrors","ApiError","join","JSON","stringify","parameters","isRuleInstance","body","getHuePayload","validateRulePayloadForBridge","type","hueRule","name","conditions","actions","hueErrors","description","success","length"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,QAAR,GAAmB,KAAK,CAAxB;;AACA,MAAMC,kBAAkB,GAAGC,OAAO,CAAC,gCAAD,CAAlC;;AACA,MAAMC,mBAAmB,GAAGD,OAAO,CAAC,sCAAD,CAAnC;;AACA,MAAME,aAAa,GAAGF,OAAO,CAAC,eAAD,CAA7B;;AACA,MAAMG,MAAM,GAAGH,OAAO,CAAC,eAAD,CAAtB;;AACA,MAAMI,UAAU,GAAGJ,OAAO,CAAC,mBAAD,CAA1B;;AACA,MAAMK,cAAc,GAAGN,kBAAkB,CAACO,KAAnB,CAAyBD,cAAhD;AACA,MAAME,mBAAmB,GAAG,IAAIN,mBAAmB,CAACO,iBAAxB,EAA5B;AACA,MAAMV,QAAQ,GAAG;AACbW,EAAAA,MAAM,EAAE,IAAIP,aAAa,CAACQ,WAAlB,GACHC,GADG,GAEHC,UAFG,GAGHC,GAHG,CAGC,mBAHD,EAIHC,QAJG,GAKHC,WALG,CAKSC,oBALT,CADK;AAObC,EAAAA,OAAO,EAAE,IAAIf,aAAa,CAACQ,WAAlB,GACJC,GADI,GAEJC,UAFI,GAGJC,GAHI,CAGA,uBAHA,EAIJK,WAJI,CAIQX,mBAJR,EAKJO,QALI,GAMJC,WANI,CAMQI,mBANR,CAPI;AAcbC,EAAAA,UAAU,EAAE,IAAIlB,aAAa,CAACQ,WAAlB,GACPW,IADO,GAEPT,UAFO,GAGPC,GAHO,CAGH,mBAHG,EAIPC,QAJO,GAKPQ,OALO,CAKCC,iBALD,EAMPR,WANO,CAMKS,mBANL,CAdC;AAqBbC,EAAAA,UAAU,EAAE,IAAIvB,aAAa,CAACQ,WAAlB,GACPgB,GADO,GAEPd,UAFO,GAGPC,GAHO,CAGH,wBAHG,EAIPK,WAJO,CAIKX,mBAJL,EAKPO,QALO,GAMPQ,OANO,CAMCK,uBAND,EAOPZ,WAPO,CAOKZ,MAAM,CAACyB,wBAPZ,CArBC;AA6BbC,EAAAA,UAAU,EAAE,IAAI3B,aAAa,CAACQ,WAAlB,GACPoB,MADO,GAEPlB,UAFO,GAGPC,GAHO,CAGH,wBAHG,EAIPK,WAJO,CAIKX,mBAJL,EAKPO,QALO,GAMPC,WANO,CAMKgB,oBANL;AA7BC,CAAjB;AAqCAnC,OAAO,CAACE,QAAR,GAAmBA,QAAnB;;AACA,SAASkB,oBAAT,CAA8BgB,MAA9B,EAAsC;AAClC,MAAIC,KAAK,GAAG,EAAZ;AACAvC,EAAAA,MAAM,CAACwC,IAAP,CAAYF,MAAZ,EAAoBG,OAApB,CAA4B,UAAUC,EAAV,EAAc;AACtC,UAAMC,IAAI,GAAGtC,kBAAkB,CAACO,KAAnB,CAAyBgC,gBAAzB,CAA0C,MAA1C,EAAkDF,EAAlD,EAAsDJ,MAAM,CAACI,EAAD,CAA5D,CAAb;AACAH,IAAAA,KAAK,CAACM,IAAN,CAAWF,IAAX;AACH,GAHD;AAIA,SAAOJ,KAAP;AACH;;AACD,SAASd,mBAAT,CAA6BqB,IAA7B,EAAmCC,iBAAnC,EAAsD;AAClD,QAAML,EAAE,GAAG7B,mBAAmB,CAACmC,QAApB,CAA6BD,iBAA7B,CAAX;AACA,SAAO1C,kBAAkB,CAACO,KAAnB,CAAyBgC,gBAAzB,CAA0C,MAA1C,EAAkDF,EAAlD,EAAsDI,IAAtD,CAAP;AACH;;AACD,SAAST,oBAAT,CAA8BC,MAA9B,EAAsC;AAClC,MAAI,CAAC,CAAC,GAAG7B,MAAM,CAACwC,aAAX,EAA0BX,MAA1B,CAAL,EAAwC;AACpC,UAAMY,MAAM,GAAG,CAAC,GAAGzC,MAAM,CAAC0C,WAAX,EAAwBb,MAAxB,CAAf;AACA,UAAM,IAAI5B,UAAU,CAAC0C,QAAf,CAAwBF,MAAM,GAAGA,MAAM,CAACG,IAAP,CAAY,IAAZ,CAAH,GAAwB,sBAAqBC,IAAI,CAACC,SAAL,CAAejB,MAAf,CAAuB,EAAlG,CAAN;AACH;;AACD,SAAO,IAAP;AACH;;AACD,SAAST,iBAAT,CAA2B2B,UAA3B,EAAuC;AACnC,QAAMb,IAAI,GAAGa,UAAU,CAACb,IAAxB;;AACA,MAAI,CAACA,IAAL,EAAW;AACP,UAAM,IAAIjC,UAAU,CAAC0C,QAAf,CAAwB,kBAAxB,CAAN;AACH,GAFD,MAGK,IAAI,CAACzC,cAAc,CAAC8C,cAAf,CAA8Bd,IAA9B,CAAL,EAA0C;AAC3C,UAAM,IAAIjC,UAAU,CAAC0C,QAAf,CAAwB,kCAAxB,CAAN;AACH;;AACD,QAAMM,IAAI,GAAGf,IAAI,CAACgB,aAAL,EAAb;AACAC,EAAAA,4BAA4B,CAACF,IAAD,CAA5B;AACA,SAAO;AACHG,IAAAA,IAAI,EAAE,kBADH;AAEHH,IAAAA,IAAI,EAAEA;AAFH,GAAP;AAIH;;AACD,SAASzB,uBAAT,CAAiCuB,UAAjC,EAA6C;AACzC,QAAMb,IAAI,GAAGa,UAAU,CAACb,IAAxB;;AACA,MAAI,CAACA,IAAL,EAAW;AACP,UAAM,IAAIjC,UAAU,CAAC0C,QAAf,CAAwB,kBAAxB,CAAN;AACH,GAFD,MAGK,IAAI,CAACzC,cAAc,CAAC8C,cAAf,CAA8Bd,IAA9B,CAAL,EAA0C;AAC3C,UAAM,IAAIjC,UAAU,CAAC0C,QAAf,CAAwB,kCAAxB,CAAN;AACH;;AACD,QAAMU,OAAO,GAAGnB,IAAI,CAACgB,aAAL,EAAhB;AAAA,QAAsCD,IAAI,GAAG;AACzCK,IAAAA,IAAI,EAAED,OAAO,CAACC,IAD2B;AAEzCC,IAAAA,UAAU,EAAEF,OAAO,CAACE,UAFqB;AAGzCC,IAAAA,OAAO,EAAEH,OAAO,CAACG;AAHwB,GAA7C;AAKAL,EAAAA,4BAA4B,CAACF,IAAD,CAA5B;AACA,SAAO;AACHG,IAAAA,IAAI,EAAE,kBADH;AAEHH,IAAAA,IAAI,EAAEA;AAFH,GAAP;AAIH;;AACD,SAAS5B,mBAAT,CAA6BQ,MAA7B,EAAqC;AACjC,QAAM4B,SAAS,GAAG,CAAC,GAAGzD,MAAM,CAAC0C,WAAX,EAAwBb,MAAxB,CAAlB,CADiC,CACkB;;AACnD,MAAI4B,SAAJ,EAAe;AACX,UAAM,IAAIxD,UAAU,CAAC0C,QAAf,CAAyB,wBAAuBc,SAAS,CAAC,CAAD,CAAT,CAAaC,WAAY,EAAzE,EAA4ED,SAAS,CAAC,CAAD,CAArF,CAAN;AACH;;AACD,SAAO;AAAExB,IAAAA,EAAE,EAAEJ,MAAM,CAAC,CAAD,CAAN,CAAU8B,OAAV,CAAkB1B;AAAxB,GAAP;AACH;;AACD,SAASkB,4BAAT,CAAsCjB,IAAtC,EAA4C;AACxC,MAAI,CAACA,IAAI,CAACoB,IAAV,EAAgB;AACZ,UAAM,IAAIrD,UAAU,CAAC0C,QAAf,CAAwB,sCAAxB,CAAN;AACH;;AACD,MAAI,CAACT,IAAI,CAACqB,UAAN,IAAoBrB,IAAI,CAACqB,UAAL,CAAgBK,MAAhB,GAAyB,CAAjD,EAAoD;AAChD,UAAM,IAAI3D,UAAU,CAAC0C,QAAf,CAAwB,yCAAxB,CAAN;AACH;;AACD,MAAI,CAACT,IAAI,CAACsB,OAAN,IAAiBtB,IAAI,CAACsB,OAAL,CAAaI,MAAb,GAAsB,CAA3C,EAA8C;AAC1C,UAAM,IAAI3D,UAAU,CAAC0C,QAAf,CAAwB,sCAAxB,CAAN;AACH;AACJ","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.rulesApi = void 0;\nconst hue_bridge_model_1 = require(\"@peter-murray/hue-bridge-model\");\nconst RuleIdPlaceholder_1 = require(\"../../placeholders/RuleIdPlaceholder\");\nconst ApiEndpoint_1 = require(\"./ApiEndpoint\");\nconst util_1 = require(\"../../../util\");\nconst ApiError_1 = require(\"../../../ApiError\");\nconst instanceChecks = hue_bridge_model_1.model.instanceChecks;\nconst RULE_ID_PLACEHOLDER = new RuleIdPlaceholder_1.RuleIdPlaceholder();\nconst rulesApi = {\n    getAll: new ApiEndpoint_1.ApiEndpoint()\n        .get()\n        .acceptJson()\n        .uri('/<username>/rules')\n        .pureJson()\n        .postProcess(createAllRulesResult),\n    getRule: new ApiEndpoint_1.ApiEndpoint()\n        .get()\n        .acceptJson()\n        .uri('<username>/rules/<id>')\n        .placeholder(RULE_ID_PLACEHOLDER)\n        .pureJson()\n        .postProcess(createGetRuleResult),\n    createRule: new ApiEndpoint_1.ApiEndpoint()\n        .post()\n        .acceptJson()\n        .uri('/<username>/rules')\n        .pureJson()\n        .payload(createRulePayload)\n        .postProcess(getCreateRuleResult),\n    updateRule: new ApiEndpoint_1.ApiEndpoint()\n        .put()\n        .acceptJson()\n        .uri('/<username>/rules/<id>')\n        .placeholder(RULE_ID_PLACEHOLDER)\n        .pureJson()\n        .payload(createRuleUpdatePayload)\n        .postProcess(util_1.extractUpdatedAttributes),\n    deleteRule: new ApiEndpoint_1.ApiEndpoint()\n        .delete()\n        .acceptJson()\n        .uri('/<username>/rules/<id>')\n        .placeholder(RULE_ID_PLACEHOLDER)\n        .pureJson()\n        .postProcess(validateRuleDeletion),\n};\nexports.rulesApi = rulesApi;\nfunction createAllRulesResult(result) {\n    let rules = [];\n    Object.keys(result).forEach(function (id) {\n        const rule = hue_bridge_model_1.model.createFromBridge('rule', id, result[id]);\n        rules.push(rule);\n    });\n    return rules;\n}\nfunction createGetRuleResult(data, requestParameters) {\n    const id = RULE_ID_PLACEHOLDER.getValue(requestParameters);\n    return hue_bridge_model_1.model.createFromBridge('rule', id, data);\n}\nfunction validateRuleDeletion(result) {\n    if (!(0, util_1.wasSuccessful)(result)) {\n        const parsed = (0, util_1.parseErrors)(result);\n        throw new ApiError_1.ApiError(parsed ? parsed.join(', ') : `Unexpected result: ${JSON.stringify(result)}`);\n    }\n    return true;\n}\nfunction createRulePayload(parameters) {\n    const rule = parameters.rule;\n    if (!rule) {\n        throw new ApiError_1.ApiError('No rule provided');\n    }\n    else if (!instanceChecks.isRuleInstance(rule)) {\n        throw new ApiError_1.ApiError('Must provide a valid Rule object');\n    }\n    const body = rule.getHuePayload();\n    validateRulePayloadForBridge(body);\n    return {\n        type: 'application/json',\n        body: body\n    };\n}\nfunction createRuleUpdatePayload(parameters) {\n    const rule = parameters.rule;\n    if (!rule) {\n        throw new ApiError_1.ApiError('No rule provided');\n    }\n    else if (!instanceChecks.isRuleInstance(rule)) {\n        throw new ApiError_1.ApiError('Must provide a valid Rule object');\n    }\n    const hueRule = rule.getHuePayload(), body = {\n        name: hueRule.name,\n        conditions: hueRule.conditions,\n        actions: hueRule.actions\n    };\n    validateRulePayloadForBridge(body);\n    return {\n        type: 'application/json',\n        body: body\n    };\n}\nfunction getCreateRuleResult(result) {\n    const hueErrors = (0, util_1.parseErrors)(result); //TODO not sure if this still gets called as the request handles some of this\n    if (hueErrors) {\n        throw new ApiError_1.ApiError(`Error creating rule: ${hueErrors[0].description}`, hueErrors[0]);\n    }\n    return { id: result[0].success.id };\n}\nfunction validateRulePayloadForBridge(rule) {\n    if (!rule.name) {\n        throw new ApiError_1.ApiError('A name must be provided for the Rule');\n    }\n    if (!rule.conditions || rule.conditions.length < 1) {\n        throw new ApiError_1.ApiError('A Rule must have at least one condition');\n    }\n    if (!rule.actions || rule.actions.length < 1) {\n        throw new ApiError_1.ApiError('A Rule must have at least one action');\n    }\n}\n"]},"metadata":{},"sourceType":"script"}